# 小文章浏览网站开发文档

## 版本信息

- **当前版本**: v1.0
- **开发状态**: 已发布

## 项目概述
开发一个个人专用的文章浏览网站，基于MariaDB数据库和PHP后端，提供文章浏览、搜索、收藏、删除等功能，支持响应式设计和主题切换。

## 数据库设计

### 数据表结构
```sql
CREATE TABLE `bookhub` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `title` varchar(200) DEFAULT NULL,
  `info` longtext DEFAULT NULL,
  `hits` int(10) DEFAULT NULL,
  `store` int(1) DEFAULT NULL,
  PRIMARY KEY (`id`),
  FULLTEXT KEY `title` (`title`)
) ENGINE=InnoDB AUTO_INCREMENT=25671 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci
```

### 字段说明
- `id`: 文章唯一标识，自增主键
- `title`: 文章标题，支持全文检索
- `info`: 文章内容
- `hits`: 点击量
- `store`: 收藏状态（0-未收藏，1-已收藏）

## 功能需求

### 核心功能
1. **文章列表展示**
   - 显示文章标题、简述、点击量
   - 无限滚动加载
   - 响应式布局

2. **文章浏览**
   - 点击标题弹出模态框显示完整内容
   - 模态框内支持收藏操作
   - 阅读时自动记录点击量

3. **交互功能**
   - 鼠标悬停显示操作按钮（删除、收藏）
   - 实时搜索（支持标题全文检索）
   - 点击量排行展示
   - 收藏管理

4. **主题系统**
   - 白天/夜间主题切换
   - 适合长时间阅读的配色方案
   - 主题偏好本地存储
   - 页面简介干净

### 技术实现

#### 前端技术栈
- HTML5 + CSS3 + JavaScript (ES6+)
- 响应式设计（Flexbox/Grid）
- 异步数据加载（Fetch API）
- 模态框组件（自定义或轻量级库）

#### 后端技术栈
- PHP 7.4+
- MariaDB/MySQL
- PDO数据库连接

## 页面结构设计

### 主要界面组件
1. **顶部导航栏**
   - 网站标题/Logo
   - 搜索框
   - 主题切换按钮
   - 排序选项（点击量、最新）

2. **文章列表区域**
   - 文章卡片布局
   - 无限滚动容器
   - 加载状态指示器

3. **文章详情模态框**
   - 全屏或大尺寸覆盖层
   - 文章标题和内容区域
   - 操作按钮（收藏、关闭）

4. **侧边栏（可选）**
   - 热门文章排行
   - 收藏文章列表

## API接口设计

### 文章列表接口
```
GET /api/articles.php
参数:
- page: 页码（用于无限滚动）
- limit: 每页数量
- search: 搜索关键词
- sort: 排序方式（hits, newest）

响应:
{
  "data": [
    {
      "id": 1,
      "title": "文章标题",
      "preview": "文章简述...",
      "hits": 150,
      "store": 0
    }
  ],
  "hasMore": true
}
```

**摘要处理说明**：
- `preview`字段包含经过特殊处理的文章摘要内容
- **普通模式处理流程**：
  1. 获取完整文章内容进行处理（不再限制初始截取长度）
  2. 移除所有HTML标签
  3. 清理所有空白字符（空格、制表符、换行符等Unicode空白字符）
  4. 过滤只保留中文字符和必要标点符号（，。？！、：；）
  5. 使用智能中文提取算法，确保即使原始文本包含大量英文和数字，仍能提取到足够的中文字符
  6. 精确控制为80个字符，并添加省略号
- **搜索模式处理流程**（关键词匹配时）：
  1. 查找关键词在清理后文本中的位置
  2. 展示关键词命中位置前20个中文字符和后40个中文字符的上下文内容
  3. 在非开头位置添加前置省略号
  4. 在非结尾位置添加后置省略号
  5. 确保摘要包含关键词及其相关上下文，提升搜索结果相关性
- 此优化确保摘要内容更加干净、专业，只包含有意义的中文信息，搜索时更能直观展示关键词上下文，提升用户阅读体验

### 文章详情接口
```
GET /api/article.php?id=1
响应:
{
  "id": 1,
  "title": "文章标题",
  "content": "完整文章内容...",
  "hits": 151,
  "store": 0
}
```

### 操作接口
```
POST /api/action.php
参数:
- action: "store"|"delete"|"hits"
- id: 文章ID

响应:
{
  "success": true,
  "message": "操作成功"
}
```

## 详细功能说明

### 摘要优化功能
1. **智能中文提取**：即使原始文本包含大量英文和数字，也能保证提取80个有意义的中文字符
2. **全面清理处理**：移除HTML标签、空白字符和不可见字符，只保留中文字符和必要标点
3. **长度精确控制**：确保摘要长度一致，提升UI美观性
4. **内容质量保障**：通过逐字符处理算法，确保摘要内容连贯且有意义
5. **搜索关键词上下文优化**：
   - 搜索时智能识别关键词在文本中的位置
   - 优先展示关键词前后的上下文内容
   - 为用户提供更精准的搜索结果预览，提高信息获取效率

### 无限滚动实现
1. 监听滚动事件，计算触底条件
2. 请求下一页数据
3. 平滑插入新内容
4. 显示加载状态和错误处理

### 搜索功能
1. 实时搜索建议
2. 防抖处理（300ms）
3. 高亮显示匹配关键词
4. 支持全文检索和模糊匹配
5. **搜索结果排序优化**：
   - 标题中包含搜索关键词的文章优先展示
   - 内容中包含搜索关键词的文章随后展示
   - 同类结果内部保持原有排序（默认按ID降序，最新优先）
6. **关键词上下文摘要**：
   - 当搜索关键词命中文章内容时，摘要将优先显示关键词及其上下文
   - 展示关键词命中位置前20个字符和后40个字符的内容
   - 通过省略号标识非完整文本，提升搜索结果的可读性和相关性

### 主题系统
1. CSS变量定义主题色彩
2. 本地存储用户主题偏好
3. 平滑的主题切换动画
4. 阅读友好的对比度和字体大小

## 开发计划

### 第一阶段：基础框架
- 数据库连接和基础PHP类
- 文章列表静态页面
- 基础CSS样式

### 第二阶段：核心功能
- 无限滚动加载
- 文章详情模态框
- 基础搜索功能

### 第三阶段：交互功能
- 收藏/删除操作
- 点击量统计
- 主题切换系统

### 第四阶段：优化完善
- 响应式设计优化
- 性能调优
- 错误处理和用户体验改进

## 注意事项
1. 安全性：SQL注入防护、XSS防护
2. 性能：数据库查询优化、图片懒加载
3. 可访问性：键盘导航、屏幕阅读器支持
4. 浏览器兼容性：现代浏览器支持

## 群晖NAS部署方法

1. **安装必要套件**
   - 在群晖DSM中打开「套件中心」
   - 安装「Web Station」套件
   - 安装「MariaDB」套件（推荐MariaDB 10+版本）
   - 安装「phpMyAdmin」套件（用于数据库管理，可选）

2. **配置Web Station**
   - 打开「Web Station」→「PHP设置」→「创建」
   - 选择PHP 7.4或更高版本
   - 启用必要的扩展（如mysqli、pdo_mysql等）
   - 保存设置
   - 点击「虚拟主机」→「创建」→「基于端口的设置」
   - 设置端口（如7878）和文档根目录（指向BooksWeb文件夹）
   - 选择刚才创建的PHP配置文件

3. **配置数据库**
   - 打开「phpMyAdmin」（或通过SSH连接使用命令行）
   - 创建名为`Books`的数据库
   - 导入表结构
   - 为数据库创建具有适当权限的用户（推荐使用非root用户）

4. **修改项目配置**
   - 编辑`api/db.php`文件
   - 修改数据库连接信息，使用群晖NAS的IP地址、数据库名、用户名和密码

5. **访问网站**
   - 在浏览器中输入 `http://[群晖NAS的IP地址]:[配置的端口]/`
   - 例如：`http://192.168.0.88:7878/`

## MariaDB/MySQL性能优化

若遇到数据库访问速度缓慢的问题，可通过修改配置文件解决：

1. 找到MariaDB的配置文件my.cnf（如/volume1/@appstore/MariaDB10/usr/local/mariadb10.11/etc/mysql/my.cnf）
2. 在配置文件的[mysqld]部分添加"skip-name-resolve"配置项
3. 保存修改后重启MariaDB服务（或直接重启NAS设备）

此优化措施通常能显著提升数据库的响应速度。

这个开发文档提供了项目的完整技术方案，可以作为实际开发的指导文档。